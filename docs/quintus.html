<!DOCTYPE html>  <html> <head>   <title>quintus.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="audio.html">                 audio.js               </a>                                           <a class="source" href="ball.html">                 ball.js               </a>                                           <a class="source" href="breakout-levels.html">                 breakout-levels.js               </a>                                           <a class="source" href="breakout-scenes.html">                 breakout-scenes.js               </a>                                           <a class="source" href="breakout-sprites.html">                 breakout-sprites.js               </a>                                           <a class="source" href="breakout-ui.html">                 breakout-ui.js               </a>                                           <a class="source" href="breakout.html">                 breakout.js               </a>                                           <a class="source" href="collision.html">                 collision.js               </a>                                           <a class="source" href="platformer.html">                 platformer.js               </a>                                           <a class="source" href="sprite.html">                 sprite.js               </a>                                           <a class="source" href="touch.html">                 touch.js               </a>                                           <a class="source" href="tween.html">                 tween.js               </a>                                           <a class="source" href="ui.html">                 ui.js               </a>                                           <a class="source" href="quintus.html">                 quintus.js               </a>                                           <a class="source" href="quintus_2d.html">                 quintus_2d.js               </a>                                           <a class="source" href="quintus_anim.html">                 quintus_anim.js               </a>                                           <a class="source" href="quintus_audio.html">                 quintus_audio.js               </a>                                           <a class="source" href="quintus_input.html">                 quintus_input.js               </a>                                           <a class="source" href="quintus_scenes.html">                 quintus_scenes.js               </a>                                           <a class="source" href="quintus_sprites.html">                 quintus_sprites.js               </a>                                           <a class="source" href="quintus_touch.html">                 quintus_touch.js               </a>                                           <a class="source" href="quintus_ui.html">                 quintus_ui.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               quintus.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <pre><code>Quintus Game Engine
(c) 2012 Pascal Rettig, Cykod LLC
Quintus may be freely distributed under the MIT license or GPLv2 License.
For all details and documentation:
http://html5quintus.com
</code></pre>

<h1>Quintus HTML5 Game Engine </h1>

<p>The code in <code>quintus.js</code> defines the base <code>Quintus()</code> method
which create an instance of the engine. The basic engine doesn't
do a whole lot - it provides an architecture for extension, a
game loop, and a method for creating or binding to an exsiting
canvas context. The engine has dependencies on Underscore.js and jQuery,
although the jQuery dependency will be removed in the future.</p>

<p>Most of the game-specific functionality is in the 
various other modules:</p>

<ul>
<li><code>quintus_input.js</code> - <code>Input</code> module, which allows for user input via keyboard and touchscreen</li>
<li><code>quintus_sprites.js</code> - <code>Sprites</code> module, which defines a basic <code>Q.Sprite</code> class along with spritesheet support in <code>Q.SpriteSheet</code>.</li>
<li><code>quintus_scenes.js</code> - <code>Scenes</code> module. It defines the <code>Q.Scene</code> class, which allows creation of reusable scenes, and the <code>Q.Stage</code> class, which handles managing a number of sprites at once.</li>
<li><code>quintus_anim.js</code> - <code>Anim</code> module, which adds in support for animations on sprites along with a <code>viewport</code> component to follow the player around and a <code>Q.Repeater</code> class that can create a repeating, scrolling background.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h1>Engine Bootstrapping</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Top-level Quintus engine factory wrapper, 
creates new instances of the engine by calling:</p>

<pre><code> var Q = Quintus({  ...  });
</code></pre>

<p>Any initial setup methods also all return the <code>Q</code> object, allowing any initial 
setup calls to be chained together.</p>

<pre><code> var Q = Quintus()
         .include("Input, Sprites, Scenes")
         .setup('quintus', { maximize: true })
         .controls();
</code></pre>

<p><code>Q</code> is used internally as the object name, and is used in most of the examples, 
but multiple instances of the engine on the same page can have different names.</p>

<pre><code>var Game1 = Quintus(), Game2 = Quintus();
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">Quintus</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">Quintus</span><span class="p">(</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>A la jQuery - the returned <code>Q</code> object is actually
a method that calls <code>Q.select</code>. <code>Q.select</code> doesn't do anything
initially, but can be overridden by a module to allow
selection of game objects. The <code>Scenes</code> module adds in 
the select method which selects from the default stage.</p>

<pre><code>var Q = Quintus().include("Sprites, Scenes");
... Game Code ...
// Set the angry property on all Enemy1 class objects to true
Q("Enemy1").p({ angry: true });
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">Q</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">selector</span><span class="p">,</span><span class="nx">scope</span><span class="p">,</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>   
    <span class="k">return</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="nx">selector</span><span class="p">,</span><span class="nx">scope</span><span class="p">,</span><span class="nx">options</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="nx">Q</span><span class="p">.</span><span class="nx">select</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="cm">/* No-op */</span> <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Syntax for including other modules into quintus, can accept a comma-separated
list of strings, an array of strings, or an array of actual objects. Example:</p>

<pre><code>Q.include("Input, Sprites, Scenes")
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">include</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">mod</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Q</span><span class="p">.</span><span class="nx">_each</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">_normalizeArg</span><span class="p">(</span><span class="nx">mod</span><span class="p">),</span><span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">m</span> <span class="o">=</span> <span class="nx">Quintus</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">||</span> <span class="nx">name</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">Q</span><span class="p">.</span><span class="nx">_isFunction</span><span class="p">(</span><span class="nx">m</span><span class="p">))</span> <span class="p">{</span> <span class="k">throw</span> <span class="s2">&quot;Invalid Module:&quot;</span> <span class="o">+</span> <span class="nx">name</span><span class="p">;</span> <span class="p">}</span>
      <span class="nx">m</span><span class="p">(</span><span class="nx">Q</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="nx">Q</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h1>Utility Methods</h1>

<p>Most of these utility methods are a subset of Underscore.js,
Most are pulled directly from underscore and some are
occasionally optimized for speed and memory usage in lieu of flexibility.
Underscore.js is (c) 2009-2012 Jeremy Ashkenas, DocumentCloud Inc.
Underscore is freely distributable under the MIT license.
http://underscorejs.org</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>An internal utility method (utility methods are prefixed with underscores)
It's used to take a string of comma separated names and turn it into an <code>Array</code>
of names. If an array of names is passed in, it's left as is. Example usage:</p>

<pre><code>Q._normalizeArg("Sprites, Scenes, Physics   ");
// returns [ "Sprites", "Scenes", "Physics" ]
</code></pre>

<p>Used by <code>Q.include</code> and <code>Q.Sprite.add</code> to add modules and components, respectively.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">_normalizeArg</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arg</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">_isString</span><span class="p">(</span><span class="nx">arg</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">arg</span> <span class="o">=</span> <span class="nx">arg</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\s+/g</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">Q</span><span class="p">.</span><span class="nx">_isArray</span><span class="p">(</span><span class="nx">arg</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">arg</span> <span class="o">=</span> <span class="p">[</span> <span class="nx">arg</span> <span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">arg</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Extends a destination object
with a source object</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">_extend</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dest</span><span class="p">,</span><span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">source</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">prop</span> <span class="k">in</span> <span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">dest</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="nx">source</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Return a shallow copy of an object. Sub-objects (and sub-arrays) are not cloned.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">_clone</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">_extend</span><span class="p">({},</span><span class="nx">obj</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Method that adds default properties onto
an object only if the key is undefined</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">_defaults</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dest</span><span class="p">,</span><span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">source</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">prop</span> <span class="k">in</span> <span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">dest</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">===</span> <span class="k">void</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">dest</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="nx">source</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Shortcut for hasOwnProperty</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">_has</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">key</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Check if something is a string
NOTE: this fails for non-primitives</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">_isString</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">typeof</span> <span class="nx">obj</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="nx">Q</span><span class="p">.</span><span class="nx">_isNumber</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;[object Number]&#39;</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Check if something is a function</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">_isFunction</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;[object Function]&#39;</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Check if something is a function</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">_isObject</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;[object Object]&#39;</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Check if something is a function</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">_isArray</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;[object Array]&#39;</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Check if something is undefined</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">_isUndefined</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">obj</span> <span class="o">===</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Removes a property from an object and returns it</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">_popProperty</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span><span class="nx">property</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">val</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">property</span><span class="p">];</span>
    <span class="k">delete</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">property</span><span class="p">];</span>
    <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Basic iteration method. This can often be a performance
handicap when the callback iterator is created inline,
as this leads to lots of functions that need to be GC'd.
Better is to define the iterator as a private method so
it is only created once.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">_each</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span><span class="nx">iterator</span><span class="p">,</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">forEach</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">obj</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">iterator</span><span class="p">,</span><span class="nx">context</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="o">+</span><span class="nx">obj</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">iterator</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">obj</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">iterator</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">obj</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Invoke the named property on each element of the array</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">_invoke</span><span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span><span class="nx">property</span><span class="p">,</span><span class="nx">arg1</span><span class="p">,</span><span class="nx">arg2</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">arr</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">property</span><span class="p">](</span><span class="nx">arg1</span><span class="p">,</span><span class="nx">arg2</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Basic detection method, returns the first instance where the
iterator returns truthy. </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">_detect</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span><span class="nx">iterator</span><span class="p">,</span><span class="nx">context</span><span class="p">,</span><span class="nx">arg1</span><span class="p">,</span><span class="nx">arg2</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">result</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="o">+</span><span class="nx">obj</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">result</span> <span class="o">=</span> <span class="nx">iterator</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">arg1</span><span class="p">,</span><span class="nx">arg2</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">result</span><span class="p">;</span> <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">result</span> <span class="o">=</span> <span class="nx">iterator</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">arg1</span><span class="p">,</span><span class="nx">arg2</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">result</span><span class="p">;</span> <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Returns a new Array with entries set to the return value of the iterator.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">_map</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">iterator</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">results</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">results</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">map</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">iterator</span><span class="p">,</span> <span class="nx">context</span><span class="p">);</span> <span class="p">}</span>
    <span class="nx">Q</span><span class="p">.</span><span class="nx">_each</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">list</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">results</span><span class="p">[</span><span class="nx">results</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="o">=</span> <span class="nx">iterator</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">list</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="o">+</span><span class="nx">obj</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span> <span class="nx">results</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">return</span> <span class="nx">results</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Returns a sorted copy of unique array elements with null remove</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">_uniq</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arr</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">arr</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">slice</span><span class="p">().</span><span class="nx">sort</span><span class="p">();</span>

    <span class="kd">var</span> <span class="nx">output</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="kd">var</span> <span class="nx">last</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">!==</span> <span class="k">void</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">last</span> <span class="o">!==</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="p">{</span>
        <span class="nx">output</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
      <span class="p">}</span>
      <span class="nx">last</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">output</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>returns a new array with the same entries as the source but in a random order.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">_shuffle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">shuffled</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">rand</span><span class="p">;</span>
    <span class="nx">Q</span><span class="p">.</span><span class="nx">_each</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">list</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">rand</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="nx">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
      <span class="nx">shuffled</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">=</span> <span class="nx">shuffled</span><span class="p">[</span><span class="nx">rand</span><span class="p">];</span>
      <span class="nx">shuffled</span><span class="p">[</span><span class="nx">rand</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="nx">shuffled</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Return an object's keys</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">_keys</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span> <span class="o">||</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">_isObject</span><span class="p">(</span><span class="nx">obj</span><span class="p">))</span> <span class="p">{</span> <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Invalid object&#39;</span><span class="p">);</span> <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">keys</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">obj</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">_has</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">key</span><span class="p">))</span> <span class="p">{</span> <span class="nx">keys</span><span class="p">[</span><span class="nx">keys</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="o">=</span> <span class="nx">key</span><span class="p">;</span> <span class="p">}</span> <span class="p">}</span> 
    <span class="k">return</span> <span class="nx">keys</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="nx">Q</span><span class="p">.</span><span class="nx">_range</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span><span class="nx">stop</span><span class="p">,</span><span class="nx">step</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">step</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">||</span> <span class="mi">1</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">len</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">((</span><span class="nx">stop</span> <span class="o">-</span> <span class="nx">start</span><span class="p">)</span> <span class="o">/</span> <span class="nx">step</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">range</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">len</span><span class="p">);</span>

    <span class="k">while</span><span class="p">(</span><span class="nx">idx</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">range</span><span class="p">[</span><span class="nx">idx</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="nx">start</span><span class="p">;</span>
      <span class="nx">start</span> <span class="o">+=</span> <span class="nx">step</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">range</span><span class="p">;</span>

  <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">idIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Return a unique identifier</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">_uniqueId</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">idIndex</span><span class="o">++</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <h1>Options</h1>             </td>             <td class="code">               <div class="highlight"><pre>  </pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Default engine options defining the paths 
where images, audio and other data files should be found
relative to the base HTML file. As well as a couple of other
options.</p>

<p>These can be overriden by passing in options to the <code>Quintus()</code> 
factory method, for example:</p>

<pre><code>// Override the imagePath to default to /assets/images/
var Q = Quintus({ imagePath: "/assets/images/" });
</code></pre>

<p>If you follow the default convention from the examples, however,
you should be able to call <code>Quintus()</code> without any options.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">imagePath</span><span class="o">:</span> <span class="s2">&quot;images/&quot;</span><span class="p">,</span>
    <span class="nx">audioPath</span><span class="o">:</span> <span class="s2">&quot;audio/&quot;</span><span class="p">,</span>
    <span class="nx">dataPath</span><span class="o">:</span>  <span class="s2">&quot;data/&quot;</span><span class="p">,</span>
    <span class="nx">audioSupported</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;mp3&#39;</span><span class="p">,</span><span class="s1">&#39;ogg&#39;</span> <span class="p">],</span>
    <span class="nx">sound</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">frameTimeLimit</span><span class="o">:</span> <span class="mi">100</span>
  <span class="p">};</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">_extend</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">options</span><span class="p">,</span><span class="nx">opts</span><span class="p">);</span> <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <h1>Game Loop support</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>By default the engine doesn't start a game loop until you actually tell it to.
Usually the loop is started the first time you call <code>Q.stageScene</code>, but if you 
aren't using the <code>Scenes</code> module you can explicitly start the game loop yourself
and control <strong>exactly</strong> what the engine does each cycle. For example:</p>

<pre><code>var Q = Quintus().setup();

var ball = new Q.Sprite({ .. });

Q.gameLoop(function(dt) {
  Q.clear(); 
  ball.step(dt);
  ball.draw(Q.ctx);
});
</code></pre>

<p>The callback will be called with fraction of a second that has elapsed since 
the last call to the loop method.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">gameLoop</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Q</span><span class="p">.</span><span class="nx">lastGameLoopFrame</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Short circuit the loop check in case multiple scenes
are staged immediately</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Q</span><span class="p">.</span><span class="nx">loop</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> </pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Keep track of the frame we are on (so that animations can be synced
to the next frame)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Q</span><span class="p">.</span><span class="nx">_loopFrame</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Wrap the callback to save it and standardize the passed
in time. </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Q</span><span class="p">.</span><span class="nx">gameLoopCallbackWrapper</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">now</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span>
      <span class="nx">Q</span><span class="p">.</span><span class="nx">_loopFrame</span><span class="o">++</span><span class="p">;</span>
      <span class="nx">Q</span><span class="p">.</span><span class="nx">loop</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">gameLoopCallbackWrapper</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">dt</span> <span class="o">=</span> <span class="nx">now</span> <span class="o">-</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">lastGameLoopFrame</span><span class="p">;</span>
      <span class="cm">/* Prevent fast-forwarding by limiting the length of a single frame. */</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">dt</span> <span class="o">&gt;</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">frameTimeLimit</span><span class="p">)</span> <span class="p">{</span> <span class="nx">dt</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">frameTimeLimit</span><span class="p">;</span> <span class="p">}</span>
      <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">Q</span><span class="p">,[</span><span class="nx">dt</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">]);</span>  
      <span class="nx">Q</span><span class="p">.</span><span class="nx">lastGameLoopFrame</span> <span class="o">=</span> <span class="nx">now</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="nb">window</span><span class="p">.</span><span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">gameLoopCallbackWrapper</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">Q</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>Pause the entire game by canceling the requestAnimationFrame call. If you use setTimeout or
setInterval in your game, those will, of course, keep on rolling...</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">pauseGame</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">loop</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">cancelAnimationFrame</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">loop</span><span class="p">);</span> 
    <span class="p">}</span>
    <span class="nx">Q</span><span class="p">.</span><span class="nx">loop</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>Unpause the game by restarting the requestAnimationFrame-based loop.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">unpauseGame</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">Q</span><span class="p">.</span><span class="nx">loop</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">Q</span><span class="p">.</span><span class="nx">lastGameLoopFrame</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span>
      <span class="nx">Q</span><span class="p">.</span><span class="nx">loop</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">gameLoopCallbackWrapper</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <h1>The base Class object</h1>

<p>Quintus uses the Simple JavaScript inheritance Class object, created by
John Resig and described on his blog: </p>

<p><a href="http://ejohn.org/blog/simple-javascript-inheritance/">http://ejohn.org/blog/simple-javascript-inheritance/</a></p>

<p>The class is used wholesale, with the only differences being that instead
of appearing in a top-level namespace, the <code>Class</code> object is available as 
<code>Q.Class</code> and a second argument on the <code>extend</code> method allows for adding
class level methods and the class name is passed in a parameter for introspection
purposes.</p>

<p>Classes can be created by calling <code>Q.Class.extend(name,{ .. })</code>, although most of the time
you'll want to use one of the derivitive classes, <code>Q.Evented</code> or <code>Q.GameObject</code> which
have a little bit of functionality built-in. <code>Q.Evented</code> adds event binding and 
triggering support and <code>Q.GameObject</code> adds support for components and a destroy method.</p>

<p>The main things Q.Class get you are easy inheritance, a constructor method called <code>init()</code>,
dynamic addition of a this._super method when a method is overloaded (be careful with 
this as it adds some overhead to method calls.) Calls to <code>instanceof</code> also all 
work as you'd hope.</p>

<p>By convention, classes should be added onto to the <code>Q</code> object and capitalized, so if 
you wanted to create a new class for your game, you'd write:</p>

<pre><code>Q.Class.extend("MyClass",{ ... });
</code></pre>

<p>Examples:</p>

<pre><code>Q.Class.extend("Bird",{ 
  init: function(name) { this.name = name; },
  speak: function() { console.log(this.name); },
  fly: function()   { console.log("Flying"); }
});

Q.Bird.extend("Penguin",{
  speak: function() { console.log(this.name + " the penguin"); },
  fly: function()   { console.log("Can't fly, sorry..."); }
});

var randomBird = new Q.Bird("Frank"),
    pengy      = new Q.Penguin("Pengy");

randomBird.fly(); // Logs "Flying"
pengy.fly();      // Logs "Can't fly,sorry..."

randomBird.speak(); // Logs "Frank"
pengy.speak();      // Logs "Pengy the penguin"

console.log(randomBird instanceof Q.Bird);    // true 
console.log(randomBird instanceof Q.Penguin); // false
console.log(pengy instanceof Q.Bird);         // true 
console.log(pengy instanceof Q.Penguin);      // true 
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="cm">/* Simple JavaScript Inheritance</span>
<span class="cm">   * By John Resig http://ejohn.org/</span>
<span class="cm">   * MIT Licensed.</span>
<span class="cm">   *</span>
<span class="cm">   * Inspired by base2 and Prototype</span>
<span class="cm">   */</span>
  <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">initializing</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span> 
        <span class="nx">fnTest</span> <span class="o">=</span> <span class="sr">/xyz/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span> <span class="kd">var</span> <span class="nx">xyz</span><span class="p">;})</span> <span class="o">?</span> <span class="sr">/\b_super\b/</span> <span class="o">:</span> <span class="sr">/.*/</span><span class="p">;</span>
    <span class="cm">/* The base Class implementation (does nothing) */</span>
    <span class="nx">Q</span><span class="p">.</span><span class="nx">Class</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){};</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>See if a object is a specific class</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Q</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isA</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">className</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">className</span> <span class="o">===</span> <span class="nx">className</span><span class="p">;</span>
    <span class="p">};</span>
    
    <span class="cm">/* Create a new Class that inherits from this class */</span>
    <span class="nx">Q</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">extend</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">className</span><span class="p">,</span> <span class="nx">prop</span><span class="p">,</span> <span class="nx">classMethods</span><span class="p">)</span> <span class="p">{</span>
      <span class="cm">/* No name, don&#39;t add onto Q */</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">Q</span><span class="p">.</span><span class="nx">_isString</span><span class="p">(</span><span class="nx">className</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">classMethods</span> <span class="o">=</span> <span class="nx">prop</span><span class="p">;</span>
        <span class="nx">prop</span> <span class="o">=</span> <span class="nx">className</span><span class="p">;</span>
        <span class="nx">className</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="kd">var</span> <span class="nx">_super</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span>
          <span class="nx">ThisClass</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      
      <span class="cm">/* Instantiate a base class (but only create the instance, */</span>
      <span class="cm">/* don&#39;t run the init constructor) */</span>
      <span class="nx">initializing</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">prototype</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ThisClass</span><span class="p">();</span>
      <span class="nx">initializing</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

      <span class="kd">function</span> <span class="nx">_superFactory</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">tmp</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">;</span>

          <span class="cm">/* Add a new ._super() method that is the same method */</span>
          <span class="cm">/* but on the super-class */</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">_super</span> <span class="o">=</span> <span class="nx">_super</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>

          <span class="cm">/* The method only need to be bound temporarily, so we */</span>
          <span class="cm">/* remove it when we&#39;re done executing */</span>
          <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>        
          <span class="k">this</span><span class="p">.</span><span class="nx">_super</span> <span class="o">=</span> <span class="nx">tmp</span><span class="p">;</span>

          <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
        <span class="p">};</span>
      <span class="p">}</span>

      <span class="cm">/* Copy the properties over onto the new prototype */</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">name</span> <span class="k">in</span> <span class="nx">prop</span><span class="p">)</span> <span class="p">{</span>
        <span class="cm">/* Check if we&#39;re overwriting an existing function */</span>
        <span class="nx">prototype</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">prop</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span> <span class="o">&amp;&amp;</span> 
          <span class="k">typeof</span> <span class="nx">_super</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span> <span class="o">&amp;&amp;</span> 
            <span class="nx">fnTest</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">prop</span><span class="p">[</span><span class="nx">name</span><span class="p">])</span> <span class="o">?</span> 
              <span class="nx">_superFactory</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="nx">prop</span><span class="p">[</span><span class="nx">name</span><span class="p">])</span> <span class="o">:</span> 
              <span class="nx">prop</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
      <span class="p">}</span>
      
      <span class="cm">/* The dummy class constructor */</span>
      <span class="kd">function</span> <span class="nx">Class</span><span class="p">()</span> <span class="p">{</span>
        <span class="cm">/* All construction is actually done in the init method */</span>
        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">initializing</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">init</span> <span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">init</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
      
      <span class="cm">/* Populate our constructed prototype object */</span>
      <span class="nx">Class</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nx">prototype</span><span class="p">;</span>
      
      <span class="cm">/* Enforce the constructor to be what we expect */</span>
      <span class="nx">Class</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">=</span> <span class="nx">Class</span><span class="p">;</span>
      <span class="cm">/* And make this class extendable */</span>
      <span class="nx">Class</span><span class="p">.</span><span class="nx">extend</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">extend</span><span class="p">;</span>
      
      <span class="cm">/* If there are class-level Methods, add them to the class */</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">classMethods</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Q</span><span class="p">.</span><span class="nx">_extend</span><span class="p">(</span><span class="nx">Class</span><span class="p">,</span><span class="nx">classMethods</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">if</span><span class="p">(</span><span class="nx">className</span><span class="p">)</span> <span class="p">{</span> 
        <span class="cm">/* Save the class onto Q */</span>
        <span class="nx">Q</span><span class="p">[</span><span class="nx">className</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Class</span><span class="p">;</span>

        <span class="cm">/* Let the class know its name */</span>
        <span class="nx">Class</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="nx">className</span><span class="p">;</span>
        <span class="nx">Class</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="nx">className</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="k">return</span> <span class="nx">Class</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">}());</span>
    </pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <h1>Event Handling</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>The <code>Q.Evented</code> class adds event handling onto the base <code>Q.Class</code> 
class. Evented objects can trigger events and other objects can
bind to those events.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="s2">&quot;Evented&quot;</span><span class="p">,{</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>Binds a callback to an event on this object. If you provide a
<code>target</code> object, that object will add this event to it's list of
binds, allowing it to automatically remove it when it is destroyed.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">on</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span><span class="nx">target</span><span class="p">,</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">_isArray</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">||</span> <span class="nx">event</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">event</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">_normalizeArg</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
        <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">event</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">event</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span><span class="nx">target</span><span class="p">,</span><span class="nx">callback</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>Handle the case where there is no target provided,
swapping the target and callback parameters.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">callback</span> <span class="o">=</span> <span class="nx">target</span><span class="p">;</span>
        <span class="nx">target</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>If there's still no callback, default to the event name</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">callback</span> <span class="o">=</span> <span class="nx">event</span><span class="p">;</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>Handle case for callback that is a string, this will
pull the callback from the target object or from this
object.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">_isString</span><span class="p">(</span><span class="nx">callback</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">callback</span> <span class="o">=</span> <span class="p">(</span><span class="nx">target</span> <span class="o">||</span> <span class="k">this</span><span class="p">)[</span><span class="nx">callback</span><span class="p">];</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>To keep <code>Q.Evented</code> objects from needing a constructor,
the <code>listeners</code> object is created on the fly as needed.
<code>listeners</code> keeps a list of callbacks indexed by event name
for quick lookup. </p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span> <span class="o">||</span> <span class="p">{};</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">[</span><span class="nx">event</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">[</span><span class="nx">event</span><span class="p">]</span> <span class="o">||</span> <span class="p">[];</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">[</span><span class="nx">event</span><span class="p">].</span><span class="nx">push</span><span class="p">([</span> <span class="nx">target</span> <span class="o">||</span> <span class="k">this</span><span class="p">,</span> <span class="nx">callback</span><span class="p">]);</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>With a provided target, the target object keeps track of
the events it is bound to, which allows for automatic 
unbinding on destroy.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span><span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">target</span><span class="p">.</span><span class="nx">binds</span><span class="p">)</span> <span class="p">{</span> <span class="nx">target</span><span class="p">.</span><span class="nx">binds</span> <span class="o">=</span> <span class="p">[];</span> <span class="p">}</span>
        <span class="nx">target</span><span class="p">.</span><span class="nx">binds</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="k">this</span><span class="p">,</span><span class="nx">event</span><span class="p">,</span><span class="nx">callback</span><span class="p">]);</span>
      <span class="p">}</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>Triggers an event, passing in some optional additional data about
the event. </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">trigger</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>First make sure there are any listeners, then check for any listeners
on this specific event, if not, early out.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">listeners</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">[</span><span class="nx">event</span><span class="p">])</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>Call each listener in the context of either the target passed into
<code>on</code> or the object itself.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nx">len</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">[</span><span class="nx">event</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">len</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">listener</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">[</span><span class="nx">event</span><span class="p">][</span><span class="nx">i</span><span class="p">];</span>
          <span class="nx">listener</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">call</span><span class="p">(</span><span class="nx">listener</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nx">data</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>
    </pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>Unbinds an event. Can be called with 1, 2, or 3 parameters, each 
of which unbinds a more specific listener.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">off</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span><span class="nx">target</span><span class="p">,</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>Without a target, remove all teh listeners.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">[</span><span class="nx">event</span><span class="p">])</span> <span class="p">{</span>
          <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">[</span><span class="nx">event</span><span class="p">];</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>If the callback is a string, find a method of the
same name on the target.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">_isString</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">target</span><span class="p">[</span><span class="nx">callback</span><span class="p">])</span> <span class="p">{</span>
          <span class="nx">callback</span> <span class="o">=</span> <span class="nx">target</span><span class="p">[</span><span class="nx">callback</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">l</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">[</span><span class="nx">event</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">l</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>Loop from the end to the beginning, which allows us
to remove elements without having to affect the loop.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">l</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="nx">i</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">l</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">callback</span> <span class="o">||</span> <span class="nx">callback</span> <span class="o">===</span> <span class="nx">l</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">[</span><span class="nx">event</span><span class="p">].</span><span class="nx">splice</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p><code>debind</code> is called to remove any listeners an object had
on other objects. The most common case is when an object is
destroyed you'll want all the event listeners to be removed
for you.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">debind</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">binds</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nx">len</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">binds</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">len</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
           <span class="kd">var</span> <span class="nx">boundEvent</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">binds</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span>
               <span class="nx">source</span> <span class="o">=</span> <span class="nx">boundEvent</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
               <span class="nx">event</span> <span class="o">=</span> <span class="nx">boundEvent</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
           <span class="nx">source</span><span class="p">.</span><span class="nx">off</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span><span class="k">this</span><span class="p">);</span>
         <span class="p">}</span>
       <span class="p">}</span>
     <span class="p">}</span>

   <span class="p">});</span>


   </pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <h1>Components</h1>

<p>Components are self-contained pieces of functionality that can be added onto and removed
from objects. The allow for a more dynamic functionality tree than using inheritance (i.e.
by favoring composition over inheritance) and are added and removed on the fly at runtime.
(yes, I know everything in JS is at runtime, but you know what I mean, geez)</p>

<p>Combining components with events makes it easy to create reusable pieces of
functionality that can be decoupled from each other.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>The master list of registered components, indexed in an object by name.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">components</span> <span class="o">=</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>The base class for components. These are usually not derived directly but are instead
created by calling <code>Q.register</code> to register a new component given a set of methods the 
component supports. Components are created automatically when they are added to a 
<code>Q.GameObject</code> with the <code>add</code> method.</p>

<p>Many components also define an <code>added</code> method, which is called automatically by the
<code>init</code> constructor after a component has been added to an object. This is a good time
to add event listeners on the object.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">Evented</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="s2">&quot;Component&quot;</span><span class="p">,{</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>Components are created when they are added onto a <code>Q.GameObject</code> entity. The entity
is directly extended with any methods inside of an <code>extend</code> property and then the 
component itself is added onto the entity as well. </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">entity</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">entity</span> <span class="o">=</span> <span class="nx">entity</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">extend</span><span class="p">)</span> <span class="p">{</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">_extend</span><span class="p">(</span><span class="nx">entity</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">extend</span><span class="p">);</span>   <span class="p">}</span>
      <span class="nx">entity</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

      <span class="nx">entity</span><span class="p">.</span><span class="nx">activeComponents</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">componentName</span><span class="p">);</span>

      <span class="k">if</span><span class="p">(</span><span class="nx">entity</span><span class="p">.</span><span class="nx">stage</span> <span class="o">&amp;&amp;</span> <span class="nx">entity</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">addToList</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">entity</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">addToList</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">componentName</span><span class="p">,</span><span class="nx">entity</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">added</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">added</span><span class="p">();</span> <span class="p">}</span>    
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p><code>destroy</code> is called automatically when a component is removed from an entity. It is 
not called, however, when an entity is destroyed (for performance reasons).</p>

<p>It's job is to remove any methods that were added with <code>extend</code> and then remove and
debind itself from the entity. It will also call <code>destroyed</code> if the component has
a method by that name.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">destroy</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">extend</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">extensions</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">_keys</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">extend</span><span class="p">);</span>
        <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nx">len</span><span class="o">=</span><span class="nx">extensions</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">len</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">entity</span><span class="p">[</span><span class="nx">extensions</span><span class="p">[</span><span class="nx">i</span><span class="p">]];</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">entity</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">];</span>
      <span class="kd">var</span> <span class="nx">idx</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">entity</span><span class="p">.</span><span class="nx">activeComponents</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">componentName</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">idx</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> 
        <span class="k">this</span><span class="p">.</span><span class="nx">entity</span><span class="p">.</span><span class="nx">activeComponents</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">idx</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">entity</span><span class="p">.</span><span class="nx">stage</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">entity</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">addToList</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">entity</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">addToLists</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">componentName</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">entity</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">debind</span><span class="p">();</span>
      <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">destroyed</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">destroyed</span><span class="p">();</span> <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>This is the base class most Quintus objects are derived from, it extends 
<code>Q.Evented</code> and adds component support to an object, allowing components to
be added and removed from an object. It also defines a destroyed method
which will debind the object, remove it from it's parent (usually a scene)
if it has one, and trigger a destroyed event.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">Evented</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="s2">&quot;GameObject&quot;</span><span class="p">,{</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>Simple check to see if a component already exists
on an object by searching for a property of the same name.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">has</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">component</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">[</span><span class="nx">component</span><span class="p">]</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="kc">false</span><span class="p">;</span> 
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>Adds one or more components to an object. Accepts either 
a comma separated string or an array of strings that map
to component names.</p>

<p>Instantiates a new component object of the correct type
(if the component exists) and then triggers an addComponent
event.</p>

<p>Returns the object to allow chaining.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">add</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">components</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">components</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">_normalizeArg</span><span class="p">(</span><span class="nx">components</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">activeComponents</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">activeComponents</span> <span class="o">=</span> <span class="p">[];</span> <span class="p">}</span>
      <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nx">len</span><span class="o">=</span><span class="nx">components</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">len</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">components</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span>
            <span class="nx">Comp</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">components</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">Comp</span><span class="p">)</span> <span class="p">{</span> 
          <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Comp</span><span class="p">(</span><span class="k">this</span><span class="p">);</span> 
          <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;addComponent&#39;</span><span class="p">,</span><span class="nx">c</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span> </pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>Removes one or more components from an object. Accepts the
same style of parameters as <code>add</code>. Triggers a delComponent event
and and calls destroy on the component.</p>

<p>Returns the element to allow chaining.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">del</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">components</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">components</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">_normalizeArg</span><span class="p">(</span><span class="nx">components</span><span class="p">);</span>
      <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nx">len</span><span class="o">=</span><span class="nx">components</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">len</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">components</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">name</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">name</span><span class="p">))</span> <span class="p">{</span> 
          <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;delComponent&#39;</span><span class="p">,</span><span class="k">this</span><span class="p">[</span><span class="nx">name</span><span class="p">]);</span>
          <span class="k">this</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">destroy</span><span class="p">();</span> 
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>Destroys the object by calling debind and removing the
object from it's parent. Will trigger a destroyed event
callback.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">destroy</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isDestroyed</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;destroyed&#39;</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">debind</span><span class="p">();</span>
      <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">stage</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">remove</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">isDestroyed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">destroyed</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">destroyed</span><span class="p">();</span> <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>This registers a component with the engine, making it available to <code>Q.GameObject</code>'s 
This creates a new descendent class of <code>Q.Component</code> with new methods added in.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">component</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="nx">methods</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">methods</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">components</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span> <span class="p">}</span>
    <span class="nx">methods</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
    <span class="nx">methods</span><span class="p">.</span><span class="nx">componentName</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="nx">name</span><span class="p">;</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">components</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">Component</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot;Component&quot;</span><span class="p">,</span><span class="nx">methods</span><span class="p">));</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>Generic Game State object that can be used to
track of the current state of the Game, for example when the player starts
a new game you might want to keep track of their score and remaining lives:</p>

<pre><code>Q.reset({ score: 0, lives: 2 });
</code></pre>

<p>Then in your game might want to add to the score:</p>

<pre><code> Q.state.inc("score",50);
</code></pre>

<p>In your hud, you can listen for change events on the state to update your 
display:</p>

<pre><code> Q.state.on("change.score",function() { .. update the score display .. });
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">GameObject</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="s2">&quot;GameState&quot;</span><span class="p">,{</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">p</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">_extend</span><span class="p">({},</span><span class="nx">p</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>Resets the state to value p</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">reset</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">p</span><span class="p">);</span> <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;reset&quot;</span><span class="p">);</span> <span class="p">},</span>
    </pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>Internal helper method to set an individual property</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_triggerProperty</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">p</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">!==</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">p</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;change.&quot;</span> <span class="o">+</span> <span class="nx">key</span><span class="p">,</span><span class="nx">value</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>Set one or more properties, trigger events on those
properties changing</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">properties</span><span class="p">,</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">_isObject</span><span class="p">(</span><span class="nx">properties</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">Q</span><span class="p">.</span><span class="nx">_each</span><span class="p">(</span><span class="nx">properties</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">_triggerProperty</span><span class="p">,</span><span class="k">this</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_triggerProperty</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span><span class="nx">properties</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;change&quot;</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>Increment an individual property by amount</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">inc</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">property</span><span class="p">,</span><span class="nx">amount</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">property</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">property</span><span class="p">)</span> <span class="o">+</span> <span class="nx">amount</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>Increment an individual property by amount</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">dec</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">property</span><span class="p">,</span><span class="nx">amount</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">property</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">property</span><span class="p">)</span> <span class="o">-</span> <span class="nx">amount</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>Return an individual property</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">property</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">p</span><span class="p">[</span><span class="nx">property</span><span class="p">];</span>
    <span class="p">}</span>
  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>The instance of the Q.stage property</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">GameState</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>Reset the game state and unbind all state events</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">reset</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">reset</span><span class="p">();</span> <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <h1>Canvas Methods</h1>

<p>The <code>setup</code> and <code>clear</code> method are the only two canvas-specific methods in 
the core of Quintus. <code>imageData</code>  also uses canvas but it can be used in
any type of game.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>Setup will either create a new canvas element and append it
to the body of the document or use an existing one. It will then
pull out the width and height of the canvas for engine use.</p>

<p>It also adds a wrapper container around the element.</p>

<p>If the <code>maximize</code> is set to true, the canvas element is maximized
on the page and the scroll trick is used to try to get the address bar away.</p>

<p>The engine will also resample the game to CSS dimensions at twice pixel
dimensions if the <code>resampleWidth</code> or <code>resampleHeight</code> options are set.</p>

<p>TODO: add support for auto-resize w/ engine event notifications, remove
jQuery.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">touchDevice</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;ontouchstart&#39;</span> <span class="k">in</span> <span class="nb">document</span><span class="p">);</span>

  <span class="nx">Q</span><span class="p">.</span><span class="nx">setup</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">_isObject</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">options</span> <span class="o">=</span> <span class="nx">id</span><span class="p">;</span>
      <span class="nx">id</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>
    <span class="nx">id</span> <span class="o">=</span> <span class="nx">id</span> <span class="o">||</span> <span class="s2">&quot;quintus&quot;</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">_isString</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">Q</span><span class="p">.</span><span class="nx">el</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">Q</span><span class="p">.</span><span class="nx">el</span> <span class="o">=</span> <span class="nx">id</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">Q</span><span class="p">.</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">Q</span><span class="p">.</span><span class="nx">el</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;canvas&quot;</span><span class="p">);</span>
      <span class="nx">Q</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">width</span> <span class="o">||</span> <span class="mi">320</span><span class="p">;</span>
      <span class="nx">Q</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">height</span> <span class="o">||</span> <span class="mi">420</span><span class="p">;</span>
      <span class="nx">Q</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">id</span><span class="p">;</span>

      <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">el</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">w</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span>
        <span class="nx">h</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">maxWidth</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">maxWidth</span> <span class="o">||</span> <span class="mi">5000</span><span class="p">,</span>
        <span class="nx">maxHeight</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">maxHeight</span> <span class="o">||</span> <span class="mi">5000</span><span class="p">,</span>
        <span class="nx">resampleWidth</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">resampleWidth</span><span class="p">,</span>
        <span class="nx">resampleHeight</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">resampleHeight</span><span class="p">,</span>
        <span class="nx">upsampleWidth</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">upsampleWidth</span><span class="p">,</span>
        <span class="nx">upsampleHeight</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">upsampleHeight</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">maximize</span> <span class="o">===</span> <span class="kc">true</span> <span class="o">||</span> <span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">touchDevice</span> <span class="o">&amp;&amp;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">maximize</span> <span class="o">===</span> <span class="s1">&#39;touch&#39;</span><span class="p">))</span>  <span class="p">{</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">padding</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">margin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

      <span class="nx">w</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">,</span><span class="nx">maxWidth</span><span class="p">);</span>
      <span class="nx">h</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span><span class="nx">maxHeight</span><span class="p">);</span>

      <span class="k">if</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">touchDevice</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Q</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="p">(</span><span class="nx">h</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">scrollTo</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>

        <span class="nx">w</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">,</span><span class="nx">maxWidth</span><span class="p">);</span>
        <span class="nx">h</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">,</span><span class="nx">maxHeight</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">touchDevice</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">scrollTo</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">((</span><span class="nx">upsampleWidth</span> <span class="o">&amp;&amp;</span> <span class="nx">w</span> <span class="o">&lt;=</span> <span class="nx">upsampleWidth</span><span class="p">)</span> <span class="o">||</span>
       <span class="p">(</span><span class="nx">upsampleHeight</span> <span class="o">&amp;&amp;</span> <span class="nx">h</span> <span class="o">&lt;=</span> <span class="nx">upsampleHeight</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">Q</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">h</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span>
      <span class="nx">Q</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">w</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span>
      <span class="nx">Q</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">w</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
      <span class="nx">Q</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">h</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span><span class="p">(((</span><span class="nx">resampleWidth</span> <span class="o">&amp;&amp;</span> <span class="nx">w</span> <span class="o">&gt;</span> <span class="nx">resampleWidth</span><span class="p">)</span> <span class="o">||</span>
        <span class="p">(</span><span class="nx">resampleHeight</span> <span class="o">&amp;&amp;</span> <span class="nx">h</span> <span class="o">&gt;</span> <span class="nx">resampleHeight</span><span class="p">))</span> <span class="o">&amp;&amp;</span> 
       <span class="nx">Q</span><span class="p">.</span><span class="nx">touchDevice</span><span class="p">)</span> <span class="p">{</span> 
      <span class="nx">Q</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">h</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span>
      <span class="nx">Q</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">w</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span>
      <span class="nx">Q</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">w</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
      <span class="nx">Q</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">h</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">Q</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">h</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span>
      <span class="nx">Q</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">w</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span>
      <span class="nx">Q</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">w</span><span class="p">;</span>
      <span class="nx">Q</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">h</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">elParent</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">elParent</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">Q</span><span class="p">.</span><span class="nx">wrapper</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">);</span>
      <span class="nx">Q</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39;_container&#39;</span><span class="p">;</span>
      <span class="nx">Q</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">w</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span>
      <span class="nx">Q</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">margin</span> <span class="o">=</span> <span class="s2">&quot;0 auto&quot;</span><span class="p">;</span>
      <span class="nx">Q</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="s2">&quot;relative&quot;</span><span class="p">;</span>


      <span class="nx">elParent</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">,</span><span class="nx">Q</span><span class="p">.</span><span class="nx">el</span><span class="p">);</span>
      <span class="nx">Q</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">el</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="nx">Q</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="s1">&#39;relative&#39;</span><span class="p">;</span>

    <span class="nx">Q</span><span class="p">.</span><span class="nx">ctx</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">getContext</span> <span class="o">&amp;&amp;</span> 
            <span class="nx">Q</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">);</span>


    <span class="nx">Q</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
    <span class="nx">Q</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
    <span class="nx">Q</span><span class="p">.</span><span class="nx">cssWidth</span> <span class="o">=</span> <span class="nx">w</span><span class="p">;</span>
    <span class="nx">Q</span><span class="p">.</span><span class="nx">cssHeight</span> <span class="o">=</span> <span class="nx">h</span><span class="p">;</span>

    <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;orientationchange&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nb">window</span><span class="p">.</span><span class="nx">scrollTo</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span> <span class="p">},</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="nx">Q</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>Clear the canvas completely.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">clear</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">clearColor</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">Q</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">globalAlpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="nx">Q</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">clearColor</span><span class="p">;</span>
      <span class="nx">Q</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nx">Q</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span><span class="nx">Q</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">Q</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">clearRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nx">Q</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span><span class="nx">Q</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>Return canvas image data given an Image object.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">imageData</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">img</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;canvas&quot;</span><span class="p">);</span>
    
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">img</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">img</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">);</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="nx">img</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nx">img</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span><span class="nx">img</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
  <span class="p">};</span>

  </pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <h1>Asset Loading Support</h1>

<p>The engine supports loading assets of different types using
<code>load</code> or <code>preload</code>. Assets are stored by their name so the 
same asset won't be loaded twice if it already exists.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>Augmentable list of asset types, loads a specific asset 
type if the file type matches, otherwise defaults to a Ajax
load of the data.</p>

<p>You can new types of assets based on file extension by
adding to <code>assetTypes</code> and adding a method called
loadAssetTYPENAME where TYPENAME is the name of the
type you added in.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">assetTypes</span> <span class="o">=</span> <span class="p">{</span> 
    <span class="nx">png</span><span class="o">:</span> <span class="s1">&#39;Image&#39;</span><span class="p">,</span> <span class="nx">jpg</span><span class="o">:</span> <span class="s1">&#39;Image&#39;</span><span class="p">,</span> <span class="nx">gif</span><span class="o">:</span> <span class="s1">&#39;Image&#39;</span><span class="p">,</span> <span class="nx">jpeg</span><span class="o">:</span> <span class="s1">&#39;Image&#39;</span><span class="p">,</span>
    <span class="nx">ogg</span><span class="o">:</span> <span class="s1">&#39;Audio&#39;</span><span class="p">,</span> <span class="nx">wav</span><span class="o">:</span> <span class="s1">&#39;Audio&#39;</span><span class="p">,</span> <span class="nx">m4a</span><span class="o">:</span> <span class="s1">&#39;Audio&#39;</span><span class="p">,</span> <span class="nx">mp3</span><span class="o">:</span> <span class="s1">&#39;Audio&#39;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p>Determine the type of asset based on the lookup table above</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">assetType</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">asset</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/* Determine the lowercase extension of the file */</span>
    <span class="kd">var</span> <span class="nx">fileParts</span> <span class="o">=</span> <span class="nx">asset</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">),</span>
        <span class="nx">fileExt</span> <span class="o">=</span> <span class="nx">fileParts</span><span class="p">[</span><span class="nx">fileParts</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nx">toLowerCase</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>Use the web audio loader instead of the regular loader
if it's supported.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">fileType</span> <span class="o">=</span>  <span class="nx">Q</span><span class="p">.</span><span class="nx">assetTypes</span><span class="p">[</span><span class="nx">fileExt</span><span class="p">];</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">fileType</span> <span class="o">===</span> <span class="s1">&#39;Audio&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">audio</span> <span class="o">&amp;&amp;</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">audio</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;WebAudio&quot;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">fileType</span> <span class="o">=</span> <span class="s1">&#39;WebAudio&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/* Lookup the asset in the assetTypes hash, or return other */</span>
    <span class="k">return</span> <span class="nx">fileType</span> <span class="o">||</span> <span class="s1">&#39;Other&#39;</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>Either return an absolute URL, 
or add a base to a relative URL</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">assetUrl</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">base</span><span class="p">,</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="sr">/^https?:\/\//</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="o">||</span> <span class="nx">url</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">url</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">base</span> <span class="o">+</span> <span class="nx">url</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <p>Loader for Images, creates a new <code>Image</code> object and uses the 
load callback to determine the image has been loaded</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">loadAssetImage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="nx">src</span><span class="p">,</span><span class="nx">callback</span><span class="p">,</span><span class="nx">errorCallback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">img</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">();</span>
    <span class="nx">img</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>  <span class="nx">callback</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="nx">img</span><span class="p">);</span> <span class="p">};</span>
    <span class="nx">img</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="nx">errorCallback</span><span class="p">;</span>
    <span class="nx">img</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">assetUrl</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">imagePath</span><span class="p">,</span><span class="nx">src</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p>List of mime types given an audio file extension, used to 
determine what sound types the browser can play using the 
built-in <code>Sound.canPlayType</code></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">audioMimeTypes</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">mp3</span><span class="o">:</span> <span class="s1">&#39;audio/mpeg&#39;</span><span class="p">,</span> 
                       <span class="nx">ogg</span><span class="o">:</span> <span class="s1">&#39;audio/ogg; codecs=&quot;vorbis&quot;&#39;</span><span class="p">,</span>
                       <span class="nx">m4a</span><span class="o">:</span> <span class="s1">&#39;audio/m4a&#39;</span><span class="p">,</span>
                       <span class="nx">wav</span><span class="o">:</span> <span class="s1">&#39;audio/wav&#39;</span> <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <p>Loader for Audio assets. By default chops off the extension and 
will automatically determine which of the supported types is 
playable by the browser and load that type.</p>

<p>Which types are available are determined by the file extensions
listed in the Quintus <code>options.audioSupported</code></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">loadAssetAudio</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="nx">src</span><span class="p">,</span><span class="nx">callback</span><span class="p">,</span><span class="nx">errorCallback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;audio&quot;</span><span class="p">).</span><span class="nx">play</span> <span class="o">||</span> <span class="o">!</span><span class="nx">Q</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">sound</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">callback</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="kc">null</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">snd</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Audio</span><span class="p">(),</span>
        <span class="nx">baseName</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">_removeExtension</span><span class="p">(</span><span class="nx">src</span><span class="p">),</span>
        <span class="nx">extension</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">filename</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

    <span class="cm">/* Find a supported type */</span>
    <span class="nx">extension</span> <span class="o">=</span> 
      <span class="nx">Q</span><span class="p">.</span><span class="nx">_detect</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">audioSupported</span><span class="p">,</span>
         <span class="kd">function</span><span class="p">(</span><span class="nx">extension</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">return</span> <span class="nx">snd</span><span class="p">.</span><span class="nx">canPlayType</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">audioMimeTypes</span><span class="p">[</span><span class="nx">extension</span><span class="p">])</span> <span class="o">?</span> 
                                <span class="nx">extension</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">});</span>

    <span class="cm">/* No supported audio = trigger ok callback anyway */</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">extension</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">callback</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="kc">null</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">snd</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span><span class="nx">errorCallback</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <p>Don't wait for canplaythrough on mobile</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">Q</span><span class="p">.</span><span class="nx">touchDevice</span><span class="p">)</span> <span class="p">{</span> 
      <span class="nx">snd</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;canplaythrough&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> 
        <span class="nx">callback</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="nx">snd</span><span class="p">);</span> 
      <span class="p">});</span>
    <span class="p">}</span>
    <span class="nx">snd</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span>  <span class="nx">Q</span><span class="p">.</span><span class="nx">assetUrl</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">audioPath</span><span class="p">,</span><span class="nx">baseName</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="nx">extension</span><span class="p">);</span>
    <span class="nx">snd</span><span class="p">.</span><span class="nx">load</span><span class="p">();</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">touchDevice</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">callback</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="nx">snd</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="nx">Q</span><span class="p">.</span><span class="nx">loadAssetWebAudio</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="nx">src</span><span class="p">,</span><span class="nx">callback</span><span class="p">,</span><span class="nx">errorCallback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
    <span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">assetUrl</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">audioPath</span><span class="p">,</span><span class="nx">src</span><span class="p">),</span> <span class="kc">true</span><span class="p">);</span>
    <span class="nx">request</span><span class="p">.</span><span class="nx">responseType</span> <span class="o">=</span> <span class="s2">&quot;arraybuffer&quot;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p>Our asynchronous callback</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">request</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">audioData</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">response</span><span class="p">;</span>

      <span class="nx">Q</span><span class="p">.</span><span class="nx">audioContext</span><span class="p">.</span><span class="nx">decodeAudioData</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">response</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">buffer</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">callback</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="nx">buffer</span><span class="p">);</span>
      <span class="p">},</span> <span class="nx">errorCallback</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>

  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p>Loader for other file types, just store the data
returned from an Ajax call.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">loadAssetOther</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="nx">src</span><span class="p">,</span><span class="nx">callback</span><span class="p">,</span><span class="nx">errorCallback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

    <span class="kd">var</span> <span class="nx">fileParts</span> <span class="o">=</span> <span class="nx">src</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">),</span>
        <span class="nx">fileExt</span> <span class="o">=</span> <span class="nx">fileParts</span><span class="p">[</span><span class="nx">fileParts</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nx">toLowerCase</span><span class="p">();</span>

    <span class="nx">request</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span><span class="p">(</span><span class="nx">fileExt</span> <span class="o">===</span> <span class="s1">&#39;json&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">callback</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">));</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">callback</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">errorCallback</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">};</span>

    <span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span><span class="nx">Q</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">dataPath</span> <span class="o">+</span> <span class="nx">src</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <p>Helper method to return a name without an extension</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">_removeExtension</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">filename</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">filename</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\.(\w{3,4})$/</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <p>Asset hash storing any loaded assets</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">assets</span> <span class="o">=</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-90">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-90">&#182;</a>               </div>               <p>Getter method to return an asset by its name.</p>

<p>Asset names default to their filenames, but can be overridden
by passing a hash to <code>load</code> to set different names.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">asset</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">assets</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-91">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-91">&#182;</a>               </div>               <p>Load assets, and call our callback when done.</p>

<p>Also optionally takes a <code>progressCallback</code> which will be called 
with the number of assets loaded and the total number of assets
to allow showing of a progress. </p>

<p>Assets can be passed in as an array of file names, and Quintus
will use the file names as the name for reference, or as a hash of 
<code>{ name: filename }</code>. </p>

<p>Example usage:
    Q.load(['sprites.png','sprites.,json'],function() {
       Q.stageScene("level1"); // or something to start the game.
    });</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">load</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">assets</span><span class="p">,</span><span class="nx">callback</span><span class="p">,</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">assetObj</span> <span class="o">=</span> <span class="p">{};</span>

    <span class="cm">/* Make sure we have an options hash to work with */</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{};</span> <span class="p">}</span>

    <span class="cm">/* Get our progressCallback if we have one */</span>
    <span class="kd">var</span> <span class="nx">progressCallback</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">progressCallback</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">errors</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">errorCallback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">itm</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">errors</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
          <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">errorCallback</span>  <span class="o">||</span>
           <span class="kd">function</span><span class="p">(</span><span class="nx">itm</span><span class="p">)</span> <span class="p">{</span> <span class="k">throw</span><span class="p">(</span><span class="s2">&quot;Error Loading: &quot;</span> <span class="o">+</span> <span class="nx">itm</span> <span class="p">);</span> <span class="p">})(</span><span class="nx">itm</span><span class="p">);</span>
        <span class="p">};</span>

    <span class="cm">/* Convert to an array if it&#39;s a string */</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">_isString</span><span class="p">(</span><span class="nx">assets</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">assets</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">_normalizeArg</span><span class="p">(</span><span class="nx">assets</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cm">/* If the user passed in an array, convert it */</span>
    <span class="cm">/* to a hash with lookups by filename */</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">_isArray</span><span class="p">(</span><span class="nx">assets</span><span class="p">))</span> <span class="p">{</span> 
      <span class="nx">Q</span><span class="p">.</span><span class="nx">_each</span><span class="p">(</span><span class="nx">assets</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">itm</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">_isObject</span><span class="p">(</span><span class="nx">itm</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">Q</span><span class="p">.</span><span class="nx">_extend</span><span class="p">(</span><span class="nx">assetObj</span><span class="p">,</span><span class="nx">itm</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">assetObj</span><span class="p">[</span><span class="nx">itm</span><span class="p">]</span> <span class="o">=</span> <span class="nx">itm</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="cm">/* Otherwise just use the assets as is */</span>
      <span class="nx">assetObj</span> <span class="o">=</span> <span class="nx">assets</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/* Find the # of assets we&#39;re loading */</span>
    <span class="kd">var</span> <span class="nx">assetsTotal</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">_keys</span><span class="p">(</span><span class="nx">assetObj</span><span class="p">).</span><span class="nx">length</span><span class="p">,</span>
        <span class="nx">assetsRemaining</span> <span class="o">=</span> <span class="nx">assetsTotal</span><span class="p">;</span>

    <span class="cm">/* Closure&#39;d per-asset callback gets called */</span>
    <span class="cm">/* each time an asset is successfully loadded */</span>
    <span class="kd">var</span> <span class="nx">loadedCallback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="nx">obj</span><span class="p">,</span><span class="nx">force</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">errors</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-92">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-92">&#182;</a>               </div>               <p>Prevent double callbacks (I'm looking at you Firefox, canplaythrough</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">Q</span><span class="p">.</span><span class="nx">assets</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="o">||</span><span class="nx">force</span><span class="p">)</span> <span class="p">{</span>

        <span class="cm">/* Add the object to our asset list */</span>
        <span class="nx">Q</span><span class="p">.</span><span class="nx">assets</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">;</span>

        <span class="cm">/* We&#39;ve got one less asset to load */</span>
        <span class="nx">assetsRemaining</span><span class="o">--</span><span class="p">;</span>

        <span class="cm">/* Update our progress if we have it */</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">progressCallback</span><span class="p">)</span> <span class="p">{</span> 
           <span class="nx">progressCallback</span><span class="p">(</span><span class="nx">assetsTotal</span> <span class="o">-</span> <span class="nx">assetsRemaining</span><span class="p">,</span><span class="nx">assetsTotal</span><span class="p">);</span> 
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="cm">/* If we&#39;re out of assets, call our full callback */</span>
      <span class="cm">/* if there is one */</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">assetsRemaining</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="cm">/* if we haven&#39;t set up our canvas element yet, */</span>
        <span class="cm">/* assume we&#39;re using a canvas with id &#39;quintus&#39; */</span>
        <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">Q</span><span class="p">);</span> 
      <span class="p">}</span>
    <span class="p">};</span>

    <span class="cm">/* Now actually load each asset */</span>
    <span class="nx">Q</span><span class="p">.</span><span class="nx">_each</span><span class="p">(</span><span class="nx">assetObj</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">itm</span><span class="p">,</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>

      <span class="cm">/* Determine the type of the asset */</span>
      <span class="kd">var</span> <span class="nx">assetType</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">assetType</span><span class="p">(</span><span class="nx">itm</span><span class="p">);</span>

      <span class="cm">/* If we already have the asset loaded, */</span>
      <span class="cm">/* don&#39;t load it again */</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">assets</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span> <span class="p">{</span>
        <span class="nx">loadedCallback</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="nx">Q</span><span class="p">.</span><span class="nx">assets</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span><span class="kc">true</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="cm">/* Call the appropriate loader function */</span>
        <span class="cm">/* passing in our per-asset callback */</span>
        <span class="cm">/* Dropping our asset by name into Q.assets */</span>
        <span class="nx">Q</span><span class="p">[</span><span class="s2">&quot;loadAsset&quot;</span> <span class="o">+</span> <span class="nx">assetType</span><span class="p">](</span><span class="nx">key</span><span class="p">,</span><span class="nx">itm</span><span class="p">,</span>
                                   <span class="nx">loadedCallback</span><span class="p">,</span>
                                   <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">errorCallback</span><span class="p">(</span><span class="nx">itm</span><span class="p">);</span> <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">});</span>

  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-93">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-93">&#182;</a>               </div>               <p>Array to store any assets that need to be 
preloaded</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">preloads</span> <span class="o">=</span> <span class="p">[];</span>
  </pre></div>             </td>           </tr>                               <tr id="section-94">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-94">&#182;</a>               </div>               <p>Let us gather assets to load at a later time,
and then preload them all at the same time with
a single callback. Options are passed through to the
Q.load method if used.</p>

<p>Example usage:
     Q.preload("sprites.png");
     ...
     Q.preload("sprites.json");
     ...</p>

<pre><code> Q.preload(function() {
    Q.stageScene("level1"); // or something to start the game
 });
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">preload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arg</span><span class="p">,</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">_isFunction</span><span class="p">(</span><span class="nx">arg</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">Q</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">_uniq</span><span class="p">(</span><span class="nx">Q</span><span class="p">.</span><span class="nx">preloads</span><span class="p">),</span><span class="nx">arg</span><span class="p">,</span><span class="nx">options</span><span class="p">);</span>
      <span class="nx">Q</span><span class="p">.</span><span class="nx">preloads</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">Q</span><span class="p">.</span><span class="nx">preloads</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">preloads</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">arg</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-95">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-95">&#182;</a>               </div>               <h1>Math Methods</h1>

<p>Math methods, for rotating and scaling points</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-96">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-96">&#182;</a>               </div>               <p>A list of matrices available</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">matrices2d</span> <span class="o">=</span> <span class="p">[];</span>

  <span class="nx">Q</span><span class="p">.</span><span class="nx">matrix2d</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">matrices2d</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">matrices2d</span><span class="p">.</span><span class="nx">pop</span><span class="p">().</span><span class="nx">identity</span><span class="p">()</span> <span class="o">:</span> <span class="k">new</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">Matrix2D</span><span class="p">();</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-97">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-97">&#182;</a>               </div>               <p>A 2D matrix class, optimized for 2D points,
where the last row of the matrix will always be 0,0,1 
Good Docs where: 
   https://github.com/heygrady/transform/wiki/calculating-2d-matrices</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Q</span><span class="p">.</span><span class="nx">Matrix2D</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">source</span><span class="p">)</span> <span class="p">{</span>

      <span class="k">if</span><span class="p">(</span><span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">m</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="nx">source</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">m</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span>
      <span class="p">}</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-98">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-98">&#182;</a>               </div>               <p>Turn this matrix into the identity</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">identity</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">m</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">m</span><span class="p">;</span>
      <span class="nx">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">m</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="nx">m</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">m</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">m</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-99">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-99">&#182;</a>               </div>               <p>Clone another matrix into this one</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">clone</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">matrix</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">m</span><span class="p">,</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">matrix</span><span class="p">.</span><span class="nx">m</span><span class="p">;</span>
      <span class="nx">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="nx">s</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="nx">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="nx">s</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="nx">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">s</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
      <span class="nx">d</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">=</span><span class="nx">s</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span> <span class="nx">d</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">=</span><span class="nx">s</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span> <span class="nx">d</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="nx">s</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-100">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-100">&#182;</a>               </div>               <p>a * b = 
  [ [ a11<em>b11 + a12</em>b21 ], [ a11<em>b12 + a12</em>b22 ], [ a11<em>b31 + a12</em>b32 + a13 ] ,
  [ a21<em>b11 + a22</em>b21 ], [ a21<em>b12 + a22</em>b22 ], [ a21<em>b31 + a22</em>b32 + a23 ] ]</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">multiply</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">matrix</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">m</span><span class="p">,</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">matrix</span><span class="p">.</span><span class="nx">m</span><span class="p">;</span>

      <span class="kd">var</span> <span class="nx">m11</span> <span class="o">=</span> <span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nx">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nx">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="nx">b</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
      <span class="kd">var</span> <span class="nx">m12</span> <span class="o">=</span> <span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nx">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nx">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="nx">b</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
      <span class="kd">var</span> <span class="nx">m13</span> <span class="o">=</span> <span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nx">b</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="nx">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="nx">b</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="nx">a</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

      <span class="kd">var</span> <span class="nx">m21</span> <span class="o">=</span> <span class="nx">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="nx">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nx">a</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="nx">b</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
      <span class="kd">var</span> <span class="nx">m22</span> <span class="o">=</span> <span class="nx">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="nx">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nx">a</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="nx">b</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
      <span class="kd">var</span> <span class="nx">m23</span> <span class="o">=</span> <span class="nx">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="nx">b</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="nx">a</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="nx">b</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="nx">a</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>

      <span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="nx">m11</span><span class="p">;</span> <span class="nx">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="nx">m12</span><span class="p">;</span> <span class="nx">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">m13</span><span class="p">;</span>
      <span class="nx">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">=</span><span class="nx">m21</span><span class="p">;</span> <span class="nx">a</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">=</span><span class="nx">m22</span><span class="p">;</span> <span class="nx">a</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="nx">m23</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-101">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-101">&#182;</a>               </div>               <p>Multiply this matrix by a rotation matrix rotated radians radians </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">rotate</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">radians</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">radians</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">;</span> <span class="p">}</span>
      <span class="kd">var</span> <span class="nx">cos</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">radians</span><span class="p">),</span>
          <span class="nx">sin</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">radians</span><span class="p">),</span>
          <span class="nx">m</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">m</span><span class="p">;</span>

      <span class="kd">var</span> <span class="nx">m11</span> <span class="o">=</span> <span class="nx">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nx">cos</span>  <span class="o">+</span> <span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="nx">sin</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">m12</span> <span class="o">=</span> <span class="nx">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*-</span><span class="nx">sin</span> <span class="o">+</span> <span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="nx">cos</span><span class="p">;</span>

      <span class="kd">var</span> <span class="nx">m21</span> <span class="o">=</span> <span class="nx">m</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="nx">cos</span>  <span class="o">+</span> <span class="nx">m</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="nx">sin</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">m22</span> <span class="o">=</span> <span class="nx">m</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*-</span><span class="nx">sin</span> <span class="o">+</span> <span class="nx">m</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="nx">cos</span><span class="p">;</span>

      <span class="nx">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">m11</span><span class="p">;</span> <span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">m12</span><span class="p">;</span> <span class="c1">// m[2] == m[2]</span>
      <span class="nx">m</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nx">m21</span><span class="p">;</span> <span class="nx">m</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="nx">m22</span><span class="p">;</span> <span class="c1">// m[5] == m[5]</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-102">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-102">&#182;</a>               </div>               <p>Helper method to rotate by a set number of degrees</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">rotateDeg</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">degrees</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">degrees</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">;</span> <span class="p">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">rotate</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">*</span> <span class="nx">degrees</span> <span class="o">/</span> <span class="mi">180</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-103">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-103">&#182;</a>               </div>               <p>Multiply this matrix by a scaling matrix scaling sx and sy</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">scale</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">sx</span><span class="p">,</span><span class="nx">sy</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">m</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">m</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">sy</span> <span class="o">===</span> <span class="k">void</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="nx">sy</span> <span class="o">=</span> <span class="nx">sx</span><span class="p">;</span> <span class="p">}</span>

      <span class="nx">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="nx">sx</span><span class="p">;</span>
      <span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*=</span> <span class="nx">sy</span><span class="p">;</span>
      <span class="nx">m</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*=</span> <span class="nx">sx</span><span class="p">;</span>
      <span class="nx">m</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*=</span> <span class="nx">sy</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-104">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-104">&#182;</a>               </div>               <p>Multiply this matrix by a translation matrix translate by tx and ty</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">translate</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tx</span><span class="p">,</span><span class="nx">ty</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">m</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">m</span><span class="p">;</span>

      <span class="nx">m</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nx">tx</span> <span class="o">+</span> <span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="nx">ty</span><span class="p">;</span>
      <span class="nx">m</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">m</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="nx">tx</span> <span class="o">+</span> <span class="nx">m</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="nx">ty</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-105">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-105">&#182;</a>               </div>               <p>Memory Hoggy version</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">transform</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">[</span> <span class="nx">x</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nx">y</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> 
               <span class="nx">x</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="nx">y</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="p">];</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-106">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-106">&#182;</a>               </div>               <p>Transform an object with an x and y property by this Matrix</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">transformPt</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>

      <span class="nx">obj</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nx">y</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
      <span class="nx">obj</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">x</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="nx">y</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>

      <span class="k">return</span> <span class="nx">obj</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-107">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-107">&#182;</a>               </div>               <p>Transform an array with an x and y property by this Matrix</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">transformArr</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">inArr</span><span class="p">,</span><span class="nx">outArr</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">inArr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">inArr</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
      
      <span class="nx">outArr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">x</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nx">y</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
      <span class="nx">outArr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">x</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="nx">y</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>

      <span class="k">return</span> <span class="nx">outArr</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-108">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-108">&#182;</a>               </div>               <p>Return just the x component by this Matrix</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">transformX</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">x</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nx">y</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-109">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-109">&#182;</a>               </div>               <p>Return just the y component by this Matrix</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">transformY</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">x</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="nx">y</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-110">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-110">&#182;</a>               </div>               <p>Release this Matrix to be reused</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">release</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">Q</span><span class="p">.</span><span class="nx">matrices2d</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">setContextTransform</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">m</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">m</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-111">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-111">&#182;</a>               </div>               <p>source:
 m[0] m[1] m[2]
 m[3] m[4] m[5]
 0     0   1</p>

<p>destination:
 m11  m21  dx
 m12  m22  dy
 0    0    1
 setTransform(m11, m12, m21, m22, dx, dy)</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">ctx</span><span class="p">.</span><span class="nx">transform</span><span class="p">(</span><span class="nx">m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nx">m</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="nx">m</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="nx">m</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="nx">m</span><span class="p">[</span><span class="mi">5</span><span class="p">]);</span></pre></div>             </td>           </tr>                               <tr id="section-112">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-112">&#182;</a>               </div>               <p>ctx.setTransform(m[0],m[1],m[2],m[3],m[4],m[5]);</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">}</span>

  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-113">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-113">&#182;</a>               </div>               <h1>And that's it..</h1>

<p>Return the <code>Q</code> object from the <code>Quintus()</code> factory method. Create awesome games. Repeat.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">return</span> <span class="nx">Q</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-114">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-114">&#182;</a>               </div>               <p>Lastly, add in the <code>requestAnimationFrame</code> shim, if necessary. Does nothing 
if <code>requestAnimationFrame</code> is already on the <code>window</code> object.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">lastTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">vendors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ms&#39;</span><span class="p">,</span> <span class="s1">&#39;moz&#39;</span><span class="p">,</span> <span class="s1">&#39;webkit&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">];</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">vendors</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nb">window</span><span class="p">.</span><span class="nx">requestAnimationFrame</span><span class="p">;</span> <span class="o">++</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">requestAnimationFrame</span> <span class="o">=</span> <span class="nb">window</span><span class="p">[</span><span class="nx">vendors</span><span class="p">[</span><span class="nx">x</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;RequestAnimationFrame&#39;</span><span class="p">];</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">cancelAnimationFrame</span> <span class="o">=</span> 
          <span class="nb">window</span><span class="p">[</span><span class="nx">vendors</span><span class="p">[</span><span class="nx">x</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;CancelAnimationFrame&#39;</span><span class="p">]</span> <span class="o">||</span> <span class="nb">window</span><span class="p">[</span><span class="nx">vendors</span><span class="p">[</span><span class="nx">x</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;CancelRequestAnimationFrame&#39;</span><span class="p">];</span>
    <span class="p">}</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">window</span><span class="p">.</span><span class="nx">requestAnimationFrame</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">requestAnimationFrame</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">currTime</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span>
            <span class="kd">var</span> <span class="nx">timeToCall</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">16</span> <span class="o">-</span> <span class="p">(</span><span class="nx">currTime</span> <span class="o">-</span> <span class="nx">lastTime</span><span class="p">));</span>
            <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">currTime</span> <span class="o">+</span> <span class="nx">timeToCall</span><span class="p">);</span> <span class="p">},</span> 
              <span class="nx">timeToCall</span><span class="p">);</span>
            <span class="nx">lastTime</span> <span class="o">=</span> <span class="nx">currTime</span> <span class="o">+</span> <span class="nx">timeToCall</span><span class="p">;</span>
            <span class="k">return</span> <span class="nx">id</span><span class="p">;</span>
        <span class="p">};</span>
    <span class="p">}</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">window</span><span class="p">.</span><span class="nx">cancelAnimationFrame</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">cancelAnimationFrame</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
        <span class="p">};</span>
    <span class="p">}</span>
<span class="p">}());</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 